<section class="participants" id="participants">
  <div class="container">
    <header class="section-header">
      <h4>Participants</h4>
    </header>

    <% if @course.grouped? %>
      <!-- Grouped Course: Show Project Groups -->
      <% if @group_list.present? %>
        <div class="table-container">
          <table class="participants-table">
            <thead>
              <tr>
                <th><%= image_tag "alphabet.svg" %> Group Name</th>
                <th><%= image_tag "person_grey.svg" %> Members</th>
                <th><%= image_tag "project.svg" %> Project Title</th>
                <th><%= image_tag "status_grey.svg" %> Status</th>
              </tr>
            </thead>
            <tbody>
              <% @group_list.each do |group| %>
                <% group_project = group_project_for(group, @course) %>
                <% latest_instance = group_project&.project_instances&.order(:version)&.last %>
                <% status = get_group_status(group, @course) %>
                <tr>
                  <td><%= group.name || "Group #{group.id}" %></td>
                  <td>
                    <ul class="member-list">
                      <% group.project_group_members.includes(:user).each do |member| %>
                        <li><%= member.user.username %></li>  
                      <% end %>
                    </ul>
                  </td>
                  <td><%= latest_instance&.title || '-' %></td>
                  <td>
                    <div class="participant-status-badge-<%= status %>">
                      <span class="participant-status">
                        <div class="status-indicator"></div>
                        <%= status.humanize %>
                      </span>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="empty-state">No Groups/Students have been added yet.</p>
      <% end %>

    <% else %>
      <!-- Individual Course: Show Students -->
      <% if @student_list.present? %>
        <div class="table-container">
          <table class="participants-table">
            <thead>
              <tr>
                <th><%= image_tag "alphabet.svg" %> Student Name</th>
                <th><%= image_tag "person_grey.svg" %> Student ID</th>
                <th><%= image_tag "project.svg" %> Project Title</th>
                <th><%= image_tag "status_grey.svg" %> Status</th>
              </tr>
            </thead>
            <tbody>
              <% @student_list.each do |student| %>
                <% student_project = student_project_for(student, @course) %>
                <% latest_instance = student_project&.project_instances&.order(:version)&.last %>
                <% status = get_student_status(student, @course) %>
                <tr>
                  <td>
                    <div class="profile-container">
                      <div class="profile-avatar"><%= student.username.first.upcase %></div> 
                      <span><%= student.username || '-' %></span>
                    </div>
                  </td>
                  <td><%= student.student_id || '-' %></td>
                  <td><%= latest_instance&.title || '-' %></td>
                  <td>
                    <span class="status-badge <%= status.downcase.gsub('_', '-') %>">
                      <div class="status-indicator <%= status.downcase.gsub('_', '-') %>"></div>
                      <%= status.humanize %>
                    </span>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="empty-state">No students have been enrolled yet.</p>
      <% end %>
    <% end %>

    <!-- Summary Statistics -->
    <div class="participants-summary">
      <% if @course.grouped? %>
        <p><strong>Total Groups:</strong> <%= @group_list&.count || 0 %></p>
        <p><strong>Total Students:</strong> <%= @student_list&.count || 0 %></p>
      <% else %>
        <p><strong>Total Students:</strong> <%= @student_list&.count || 0 %></p>
      <% end %>
    </div>
  </div>
</section>
