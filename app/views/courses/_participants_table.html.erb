<% if @course.grouped? %>
  <!-- Grouped Course: Show Project Groups -->
  <% if group_list.present? %>
    <div class="table-container">
      <table class="participants-table">
        <thead>
          <tr>
            <th><%= image_tag "alphabet.svg" %> Group Name</th>
            <th><%= image_tag "person_grey.svg" %> Members</th>
            <th><%= image_tag "project.svg" %> Project Title</th>
            <th><%= image_tag "status_grey.svg" %> Status</th>
            <th><%= image_tag "person_grey.svg" %> Supervisor</th>
          </tr>
        </thead>
        <tbody>
          <% group_list.each do |group| %>
            <% group_project = group_project_for(group, @course) %>
            <% latest_instance = group_project&.project_instances&.order(:version)&.last %>
            <% status = group_status(group, @course) %>
            <% supervisor = latest_instance&.supervisor %>
            <tr class="participant-row">            
              <td onclick="window.location.href='<%= participant_profile_course_path(@course, group.id, 'group') %>'">
                <%= group.group_name || "Group #{group.id}" %>
              </td>
              <td onclick="window.location.href='<%= participant_profile_course_path(@course, group.id, 'group') %>'">
                <ul class="member-list">
                  <% group.project_group_members.includes(:user).each do |member| %>
                    <div class="profile-container">
                      <div class="profile-avatar"><%= member.user.username.first.upcase %></div>
                      <span><%= member.user.username || '-' %></span>
                    </div>
                  <% end %>
                </ul>
              </td>
              <td onclick="window.location.href='<%= course_project_path(@course, group_project) %>'">
                <%= latest_instance&.title || '-' %>
              </td>
              <td onclick="window.location.href='<%= course_project_path(@course, group_project) %>'">
                <span class="status-badge <%= status.downcase.gsub('_', '-') %>">
                  <div class="status-indicator <%= status.downcase.gsub('_', '-') %>"></div>
                  <%= status.humanize %>
                </span>
              </td>
              <td onclick="window.location.href='<%= course_lecturer_path(@course, supervisor) %>'">
                <div class="profile-container">
                  <div class="profile-avatar"><%= supervisor&.username.first.upcase %></div>
                  <%= supervisor&.username || '-' %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="empty-state">
      <%= params[:status_filter].present? && params[:status_filter] != 'all' ?
          "No groups found with #{params[:status_filter].humanize} status." :
          "No Groups/Students have been added yet." %>
    </p>
  <% end %>
<% else %>
  <!-- Individual Course: Show Students -->
  <% if student_list.present? %>
    <div class="table-container">
      <table class="participants-table">
        <thead>
          <tr>
            <th><%= image_tag "alphabet.svg" %> Student Name</th>
            <th><%= image_tag "person_grey.svg" %> Student ID</th>
            <th><%= image_tag "project.svg" %> Project Title</th>
            <th><%= image_tag "status_grey.svg" %> Status</th>
            <th><%= image_tag "person_grey.svg" %> Supervisor</th>
          </tr>
        </thead>
        <tbody>
          <% student_list.each do |student| %>
            <% student_project = student_project_for(student, @course) %>
            <% latest_instance = student_project&.project_instances&.order(:version)&.last %>
            <% status = student_status(student, @course) %>
            <% supervisor = latest_instance&.supervisor %>
            <tr class="participant-row">
              <td onclick="window.location.href='<%= participant_profile_course_path(@course, student.id, 'group') %>'">
                <div class="profile-container">
                  <div class="profile-avatar"><%= student.username.first.upcase %></div>
                  <span><%= student.username || '-' %></span>
                </div>
              </td>
              <td onclick="window.location.href='<%= participant_profile_course_path(@course, student.id, 'group') %>'">
                <%= student.student_id || '-' %>
              </td>
              <td onclick="window.location.href='<%= course_project_path(@course, student_project) %>'">
                <%= latest_instance&.title || '-' %>
              </td>
              <td onclick="window.location.href='<%= course_project_path(@course, student_project) %>'">
                <span class="status-badge <%= status.downcase.gsub('_', '-') %>">
                  <div class="status-indicator <%= status.downcase.gsub('_', '-') %>"></div>
                  <%= status.humanize %>
                </span>
              </td>
              <td onclick="window.location.href='<%= course_lecturer_path(@course, supervisor) %>'">
                <div class="profile-container">
                  <div class="profile-avatar"><%= supervisor&.username.first.upcase %></div>
                  <%= supervisor&.username || '-' %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="empty-state">
      <%= params[:status_filter].present? && params[:status_filter] != 'all' ?
          "No students found with #{params[:status_filter].humanize} status." :
          "No students have been enrolled yet." %>
    </p>
  <% end %>
<% end %>