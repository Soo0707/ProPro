<!DOCTYPE html>
<html lang="en">
  <head>
    <%= stylesheet_link_tag "projects" %>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Project</title>
  </head>
  <body>
    <main class="project-edit">
      <header class="edit-header">
        <div class="edit-header-row">
          <h1 class="edit-title">
            Edit Proposal <%= image_tag("edit.svg") %>
          </h1>
        </div>
        <p class="edit-description">
          Update your project details and information below.
        </p>
      </header>
      
      <%= form_with(model: [@course, @project], url: course_project_path(@course, @project), method: :patch, class: "edit-form") do |form| %>

        <!-- Disabled title field -->
        <div class="field-row">
          <%= form.label :title, "Project Title", class: "field-label" %>
          <%= form.text_field(:title, value: @instance&.title, disabled: true, class: "form-control disabled", title: "You cannot edit this field.") %>
        </div>

        <div class="fields-container">
          <% @template_fields.each do |field| %>
            <div class="field-row">
              <%= label_tag "fields_#{field.id}",
                            field.label,
                            class: "field-label",
                            title: field.hint %>

              <% if field.hint.present? %>
                <p class="field-hint"><%= field.hint %></p>
              <% end %>

              <% existing_value = @existing_values[field.id] %>

              <% case field.field_type %>
              <% when "shorttext" %>
                <%= text_field_tag "fields[#{field.id}]",
                                  existing_value,
                                  class: "form-control",
                                  placeholder: field.hint,
                                  required: true %>
              <% when "textarea" %>
                <%= text_area_tag "fields[#{field.id}]",
                                  existing_value,
                                  class: "form-control",
                                  placeholder: field.hint,
                                  required: true %>
              <% when "dropdown" %>
                <% options = field.option_list %>
                <%= select_tag "fields[#{field.id}]",
                              options_for_select(options, existing_value),
                              prompt: "Select an option",
                              class: "form-control",
                              required: true %>
              <% when "radio" %>
                <% options = field.option_list %>
                <% options.each_with_index do |option, idx| %>
                  <%= radio_button_tag "fields[#{field.id}]",
                                       option,
                                       (option == existing_value),
                                       id: "field_#{field.id}_#{idx}",
                                       required: true %>
                  <%= label_tag "field_#{field.id}_#{idx}", option %>
                <% end %>
              <% else %>
                <%= text_field_tag "fields[#{field.id}]",
                                  existing_value,
                                  class: "form-control",
                                  required: true %>
              <% end %>
            </div>
          <% end %>

           <div class="supervisor">
            <%= label_tag :supervisor_id, "Select Supervisor" %>
            <%= select_tag :supervisor_id,options_from_collection_for_select(@lecturers, :id, :username, @preselected_lecturer_id),
              prompt: "Choose a supervisor",
              class: "form-control",
              required: true %>
            </div>
            
        </div>             
        <div class="form-actions">
          <%= link_to "← Back to Proposal", course_path(@course) %>
          <%= submit_tag "Submit", class: "btn btn-primary" %>
        </div>
      <% end %>
    </main>
  </body>
</html>
