    <%= stylesheet_link_tag "projects" %>
    <div class="fields-container">
      <% fields.each do |field| %>
        <div class="field-row"> 
          <div class="field-label">
            <%= field.project_template_field.label %>
          </div>
          <div class="field-value">
            <% if field.value.present? %>
              <% 
                if field.project_template_field.dropdown? || field.project_template_field.radio?
                  begin
                    parsed_value = JSON.parse(field.value)
                    display_value = parsed_value.is_a?(Array) ? parsed_value.join(", ") : parsed_value
                  rescue JSON::ParserError
                    display_value = field.value
                  end
                else
                  display_value = field.value
                end
              %>
              <%= display_value %>
            <% else %>
              No content provided
            <% end %>
          </div>
        </div>
      <% end %>
      <p>Based on Topic: <%= based_on_topic_name || "Own Proposal" %></p>
    </div>
    <br>

<style>
  table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
    padding: 5px;
  }

  .diff ul {
    list-style: none;
  }

  .diff del{
    text-decoration: none;
  }

  .diff ins{
    text-decoration: none;
  }
</style>

<% if @index < @instances.size %>
  <h4>Comparison with next instance</h4>
  <br>

  <table>
    <tr>
      <th>Field</th>
      <th>Deletions</th>
      <th>Additions</th>
    </tr>

    <% fields.zip(next_fields).each do |current_field, next_field| %>
      <% field_name = (current_field || next_field).project_template_field.label %>
      <% old_val    = current_field&.value.to_s %>
      <% new_val    = next_field&.value.to_s %>

      <tr>
        <td><%= field_name %></td>

        <% if old_val != new_val %>

          <% diff_class = Diffy::SplitDiff %>
          <% diff = diff_class.new(old_val, new_val, :format => :html) %>
            <td style="background:#ffecec;">
              <%= diff.left.html_safe %>
            </td>
            <td style="background:#eaffea;">
              <%= diff.right.html_safe %>
            </td>
        <% else %>
          <td colspan="2">No changes</td>
        <% end %>
      </tr>
    <% end %>
  </table>
<% end %>

