<% current_version = params[:version].to_i %>
<% oldest_version = @instances.size - 1 %>
<% latest_version = 0 %>

<! -- Version Selector -->

<% if current_version < oldest_version %>
  <%= link_to "< Previous", course_proposal_path(@course, @proposal, version: current_version + 1) %>
<% else %>
  <span style="color: gray;">< Previous</span>
<% end %>

<% if current_version > latest_version %>
  <%= link_to "Next >", course_proposal_path(@course, @proposal, version: current_version - 1) %>
<% else %>
  <span style="color: gray;">Next ></span>
<% end %>

<!-- End of Version Selector -->

<p><%= current_user&.username %></p>
<p><%= @type %></p>


<!-- Title -->
<h2><%= @current_instance.title %></h2>

<br>

<!-- Field Desc, basically everythign from the form -->

<% @fields.each do |field| %>
  <p><strong><%= field.project_template_field.label %>:</strong> <%= field.value %></p>
<% end %>

<p><strong>Owner:</strong>
  <% if @owner.is_a?(User) %>
    <%= @owner.username %>
  <% else %>
    <%= @owner.group_name %>
  <% end %>
</p>

<!-- End of Field Desc -->

<!-- Member -->
<% if @members.any? %>
  <p><strong>Group Members:</strong> <%= @members.map(&:username).join(", ") %></p>
<% end %>


<p><strong>Status: </strong><%= @proposal.status %></p>

<!-- Change Status --!>
<% if staff? %>
  <% if staff? %>
  <%= form_with url: change_status_course_proposal_path(@course, @proposal), method: :patch, local: true do |f| %>
    <%= f.label :status, "Change Project Status:" %>
    <%= f.select :status, options_for_select([["Pending", 0], ["Approved", 1], ["Rejected", 2]], @proposal.status) %>
    <%= f.submit "Update Status" %>
  <% end %>
<% end %>
<% end %>

<!-- Student Edit -->
<% if @members.include?(current_user) %>
   <% if @proposal.status == "pending" && current_version == latest_version %>
   <%= link_to "Edit Proposal", edit_course_proposal_path(@course, @proposal), class: "btn" %>
   <% else %>
  <p>Unable to Edit Proposal</p>
  <% end %>
<% end %>

<p><% @lecturers %></p>




<p>
  <%= link_to "Back to all proposals", course_proposals_path(@course) %>
</p>
